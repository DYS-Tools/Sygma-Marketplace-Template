{% extends 'base.html.twig' %} 

{% block title %}Order{% endblock %}

{% block body %}

    <div class="content-page">
          <div class="container">

              <p> https://developer.paypal.com/docs/platforms/checkout/set-up-payments/ </p>
              <p> je shouaite acheter le produits ( order/order.html.twig ) </p>
              <p> Choisir un moyen de paiement  </p>

              <!-- 1 . id button paypal generate with javascript -->
              <!--<div id="paypal-button-container">
              </div>
              -->


              <!-- 2. -->
              <div id="paypal-button-container"></div>
      </div>

    </div>

{% endblock %}

{% block javascripts %}

{{ parent() }}

    <!-- // https://developer.paypal.com/docs/checkout/integrate/# */ -->
    <script src="https://www.paypal.com/sdk/js?client-id=ASKlzgOeCEaz7OYoISCgkmuZBwmojFWrd3bIFCSTuGA_JeSbTRIYrktgyVzstPtzOHzyCqpuzkiulg5C"></script>

    <script>
        paypal.Buttons({
            createOrder: function(data, actions) {
                // This function sets up the details of the transaction, including the amount and line item details.
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '0.01'
                        }
                    }]
                });
            },
            onApprove: function(data, actions) {
                // This function captures the funds from the transaction.
                return actions.order.capture().then(function(details) {
                    // This function shows a transaction success message to your buyer.
                    alert('Transaction éfféctuer ' + details.payer.name.given_name);
                });
            }
        }).render('#paypal-button-container');
        //This function displays Smart Payment Buttons on your web page.
    </script>

    <!-- Script 1 -->
    <!--
    <script src="https://www.paypal.com/sdk/js?client-id=ASKlzgOeCEaz7OYoISCgkmuZBwmojFWrd3bIFCSTuGA_JeSbTRIYrktgyVzstPtzOHzyCqpuzkiulg5C"></script>
    <script>
        paypal.Buttons({
            // createOrder est appelé lorsque l'acheteur clique sur l'un des boutons de paiement.
            // Cette fonction doit retourner un numéro de commande ( https://developer.paypal.com/docs/api/orders/v2/#orders )
            // pour rendre le flux de paiement. Dans cet exemple,
            // createOrder appelle votre serveur pour obtenir l'ID de commande.
            createOrder: function (data, actions) {
                console.log("clic button");
                return fetch('/perso/Web-Item-Market/public/createOrder', {
                    method: 'GET'
                }).then(function(res) {
                    return res.json();
                    console.log(res.json() );
                }).then(function(data) {
                    return data.id;
                    console.log(data.id );
                    console.log(data);
                });
            },

            // onApprove est appelé lorsque l'acheteur approuve la commande.
            // Cela se produit lorsque l'acheteur termine avec succès le flux de paiement. Dans cet exemple,
            // onApprove appelle votre serveur pour effectuer un ordre de capture appel ( https://developer.paypal.com/docs/api/orders/v2/#orders_capture ).
            onApprove: function (data, actions) {
                console.log(data.orderId) ;
                return fetch('/perso/Web-Item-Market/public/captureOrder' + data.orderId, {
                    method: 'POST'
                }).then(function(res) {
                    if (!res.ok) {
                        alert('Something went wrong');
                    }
                });
            }
        }).render('#paypal-button-container');
    </script>
    -->
{% endblock %}